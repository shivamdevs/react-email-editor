{"version":3,"file":"react-email-editor-patched-xsh2.cjs.production.min.js","sources":["../src/loadScript.ts","../src/EmailEditor.tsx"],"sourcesContent":["const defaultScriptUrl = 'https://editor.unlayer.com/embed.js?2';\nconst callbacks: Function[] = [];\nlet loaded = false;\n\nconst isScriptInjected = (scriptUrl: string) => {\n  const scripts = document.querySelectorAll('script');\n  let injected = false;\n\n  scripts.forEach((script) => {\n    if (script.src.includes(scriptUrl)) {\n      injected = true;\n    }\n  });\n\n  return injected;\n};\n\nconst overrideWindowLocation = () => {\n  const originalLocation = window.location;\n\n  Object.defineProperty(window, 'location', {\n    configurable: true,\n    enumerable: true,\n    get: function() {\n      // Provide a fake location for the target script\n      return {\n        href: 'https://fake-url-for-script.com',\n        protocol: 'https:',\n        host: 'fake-url-for-script.com',\n        hostname: 'fake-url-for-script.com',\n        pathname: '/',\n        search: '',\n        hash: '',\n      };\n    },\n    set: function(newValue) {\n      originalLocation.href = newValue; // Allow regular behavior for other scripts\n    },\n  });\n\n  return () => {\n    // Restore the original window.location\n    Object.defineProperty(window, 'location', {\n      configurable: true,\n      enumerable: true,\n      value: originalLocation,\n    });\n  };\n};\n\nconst addCallback = (callback: Function) => {\n  callbacks.push(callback);\n};\n\nconst runCallbacks = () => {\n  if (loaded) {\n    let callback;\n\n    while ((callback = callbacks.shift())) {\n      callback();\n    }\n  }\n};\n\nexport const loadScript = (\n  callback: Function,\n  scriptUrl = defaultScriptUrl\n) => {\n  addCallback(callback);\n\n  if (!isScriptInjected(scriptUrl)) {\n    const cleanup = overrideWindowLocation();\n    const embedScript = document.createElement('script');\n    embedScript.setAttribute('src', scriptUrl);\n    embedScript.onload = () => {\n      loaded = true;\n      cleanup();\n      runCallbacks();\n    };\n    document.head.appendChild(embedScript);\n  } else {\n    runCallbacks();\n  }\n};\n","import React, {\n  useEffect,\n  useState,\n  useImperativeHandle,\n  useMemo,\n} from 'react';\n\nimport pkg from '../package.json';\nimport { Editor, EditorRef, EmailEditorProps } from './types';\nimport { loadScript } from './loadScript';\n\nconst win =\n  typeof window === 'undefined' ? { __unlayer_lastEditorId: 0 } : window;\nwin.__unlayer_lastEditorId = win.__unlayer_lastEditorId || 0;\n\nexport const EmailEditor = React.forwardRef<EditorRef, EmailEditorProps>(\n  (props, ref) => {\n    const { onLoad, onReady, scriptUrl, minHeight = 500, style = {} } = props;\n\n    const [editor, setEditor] = useState<Editor | null>(null);\n\n    const [hasLoadedEmbedScript, setHasLoadedEmbedScript] = useState(false);\n\n    const editorId = useMemo(\n      () => props.editorId || `editor-${++win.__unlayer_lastEditorId}`,\n      [props.editorId]\n    );\n\n    const options: EmailEditorProps['options'] = {\n      ...(props.options || {}),\n      appearance: props.appearance ?? props.options?.appearance,\n      displayMode: props?.displayMode || props.options?.displayMode || 'email',\n      locale: props.locale ?? props.options?.locale,\n      projectId: props.projectId ?? props.options?.projectId,\n      tools: props.tools ?? props.options?.tools,\n\n      id: editorId,\n      source: {\n        name: pkg.name,\n        version: pkg.version,\n      },\n    };\n\n    useImperativeHandle(\n      ref,\n      () => ({\n        editor,\n      }),\n      [editor]\n    );\n\n    useEffect(() => {\n      return () => {\n        editor?.destroy();\n      };\n    }, []);\n\n    useEffect(() => {\n      setHasLoadedEmbedScript(false);\n      loadScript(() => setHasLoadedEmbedScript(true), scriptUrl);\n    }, [scriptUrl]);\n\n    useEffect(() => {\n      if (!hasLoadedEmbedScript) return;\n      editor?.destroy();\n      setEditor(unlayer.createEditor(options));\n    }, [JSON.stringify(options), hasLoadedEmbedScript]);\n\n    const methodProps = Object.keys(props).filter((propName) =>\n      /^on/.test(propName)\n    );\n    useEffect(() => {\n      if (!editor) return;\n\n      onLoad?.(editor);\n\n      // All properties starting with on[Name] are registered as event listeners.\n      methodProps.forEach((methodProp) => {\n        if (\n          /^on/.test(methodProp) &&\n          methodProp !== 'onLoad' &&\n          methodProp !== 'onReady' &&\n          typeof props[methodProp] === 'function'\n        ) {\n          editor.addEventListener(methodProp, props[methodProp]);\n        }\n      });\n\n      if (onReady) {\n        editor.addEventListener('editor:ready', () => {\n          onReady(editor);\n        });\n      }\n    }, [editor, Object.keys(methodProps).join(',')]);\n\n    return (\n      <div\n        style={{\n          flex: 1,\n          display: 'flex',\n          minHeight: minHeight,\n        }}\n      >\n        <div id={editorId} style={{ ...style, flex: 1 }} />\n      </div>\n    );\n  }\n);\n"],"names":["callbacks","loaded","runCallbacks","callback","shift","win","window","__unlayer_lastEditorId","EmailEditor","React","forwardRef","props","ref","onLoad","onReady","scriptUrl","_props$minHeight","minHeight","_props$style","style","useState","editor","setEditor","hasLoadedEmbedScript","setHasLoadedEmbedScript","editorId","useMemo","options","appearance","_props$options","displayMode","_props$options2","locale","_props$options3","projectId","_props$options4","tools","_props$options5","id","source","name","version","useImperativeHandle","useEffect","destroy","push","scripts","document","querySelectorAll","injected","forEach","script","src","includes","isScriptInjected","cleanup","originalLocation","location","Object","defineProperty","configurable","enumerable","get","href","protocol","host","hostname","pathname","search","hash","set","newValue","value","embedScript","createElement","setAttribute","onload","head","appendChild","loadScript","unlayer","createEditor","JSON","stringify","methodProps","keys","filter","propName","test","methodProp","addEventListener","join","flex","display"],"mappings":"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"}