{"version":3,"file":"react-email-editor-patched-xsh2.cjs.development.js","sources":["../src/loadScript.ts","../src/EmailEditor.tsx"],"sourcesContent":["const defaultScriptUrl = 'https://editor.unlayer.com/embed.js?2';\nconst callbacks: Function[] = [];\nlet loaded = false;\n\nconst isScriptInjected = (scriptUrl: string) => {\n  const scripts = document.querySelectorAll('script');\n  let injected = false;\n\n  scripts.forEach((script) => {\n    if (script.src.includes(scriptUrl)) {\n      injected = true;\n    }\n  });\n\n  return injected;\n};\n\nconst overrideWindowLocation = () => {\n  const originalLocation = window.location;\n\n  Object.defineProperty(window, 'location', {\n    configurable: true,\n    enumerable: true,\n    get: function() {\n      // Provide a fake location for the target script\n      return {\n        href: 'https://fake-url-for-script.com',\n        protocol: 'https:',\n        host: 'fake-url-for-script.com',\n        hostname: 'fake-url-for-script.com',\n        pathname: '/',\n        search: '',\n        hash: '',\n      };\n    },\n    set: function(newValue) {\n      originalLocation.href = newValue; // Allow regular behavior for other scripts\n    },\n  });\n\n  return () => {\n    // Restore the original window.location\n    Object.defineProperty(window, 'location', {\n      configurable: true,\n      enumerable: true,\n      value: originalLocation,\n    });\n  };\n};\n\nconst addCallback = (callback: Function) => {\n  callbacks.push(callback);\n};\n\nconst runCallbacks = () => {\n  if (loaded) {\n    let callback;\n\n    while ((callback = callbacks.shift())) {\n      callback();\n    }\n  }\n};\n\nexport const loadScript = (\n  callback: Function,\n  scriptUrl = defaultScriptUrl\n) => {\n  addCallback(callback);\n\n  if (!isScriptInjected(scriptUrl)) {\n    const cleanup = overrideWindowLocation();\n    const embedScript = document.createElement('script');\n    embedScript.setAttribute('src', scriptUrl);\n    embedScript.onload = () => {\n      loaded = true;\n      cleanup();\n      runCallbacks();\n    };\n    document.head.appendChild(embedScript);\n  } else {\n    runCallbacks();\n  }\n};\n","import React, {\n  useEffect,\n  useState,\n  useImperativeHandle,\n  useMemo,\n} from 'react';\n\nimport pkg from '../package.json';\nimport { Editor, EditorRef, EmailEditorProps } from './types';\nimport { loadScript } from './loadScript';\n\nconst win =\n  typeof window === 'undefined' ? { __unlayer_lastEditorId: 0 } : window;\nwin.__unlayer_lastEditorId = win.__unlayer_lastEditorId || 0;\n\nexport const EmailEditor = React.forwardRef<EditorRef, EmailEditorProps>(\n  (props, ref) => {\n    const { onLoad, onReady, scriptUrl, minHeight = 500, style = {} } = props;\n\n    const [editor, setEditor] = useState<Editor | null>(null);\n\n    const [hasLoadedEmbedScript, setHasLoadedEmbedScript] = useState(false);\n\n    const editorId = useMemo(\n      () => props.editorId || `editor-${++win.__unlayer_lastEditorId}`,\n      [props.editorId]\n    );\n\n    const options: EmailEditorProps['options'] = {\n      ...(props.options || {}),\n      appearance: props.appearance ?? props.options?.appearance,\n      displayMode: props?.displayMode || props.options?.displayMode || 'email',\n      locale: props.locale ?? props.options?.locale,\n      projectId: props.projectId ?? props.options?.projectId,\n      tools: props.tools ?? props.options?.tools,\n\n      id: editorId,\n      source: {\n        name: pkg.name,\n        version: pkg.version,\n      },\n    };\n\n    useImperativeHandle(\n      ref,\n      () => ({\n        editor,\n      }),\n      [editor]\n    );\n\n    useEffect(() => {\n      return () => {\n        editor?.destroy();\n      };\n    }, []);\n\n    useEffect(() => {\n      setHasLoadedEmbedScript(false);\n      loadScript(() => setHasLoadedEmbedScript(true), scriptUrl);\n    }, [scriptUrl]);\n\n    useEffect(() => {\n      if (!hasLoadedEmbedScript) return;\n      editor?.destroy();\n      setEditor(unlayer.createEditor(options));\n    }, [JSON.stringify(options), hasLoadedEmbedScript]);\n\n    const methodProps = Object.keys(props).filter((propName) =>\n      /^on/.test(propName)\n    );\n    useEffect(() => {\n      if (!editor) return;\n\n      onLoad?.(editor);\n\n      // All properties starting with on[Name] are registered as event listeners.\n      methodProps.forEach((methodProp) => {\n        if (\n          /^on/.test(methodProp) &&\n          methodProp !== 'onLoad' &&\n          methodProp !== 'onReady' &&\n          typeof props[methodProp] === 'function'\n        ) {\n          editor.addEventListener(methodProp, props[methodProp]);\n        }\n      });\n\n      if (onReady) {\n        editor.addEventListener('editor:ready', () => {\n          onReady(editor);\n        });\n      }\n    }, [editor, Object.keys(methodProps).join(',')]);\n\n    return (\n      <div\n        style={{\n          flex: 1,\n          display: 'flex',\n          minHeight: minHeight,\n        }}\n      >\n        <div id={editorId} style={{ ...style, flex: 1 }} />\n      </div>\n    );\n  }\n);\n"],"names":["defaultScriptUrl","callbacks","loaded","isScriptInjected","scriptUrl","scripts","document","querySelectorAll","injected","forEach","script","src","includes","overrideWindowLocation","originalLocation","window","location","Object","defineProperty","configurable","enumerable","get","href","protocol","host","hostname","pathname","search","hash","set","newValue","value","addCallback","callback","push","runCallbacks","shift","loadScript","cleanup","embedScript","createElement","setAttribute","onload","head","appendChild","win","__unlayer_lastEditorId","EmailEditor","React","forwardRef","props","ref","onLoad","onReady","minHeight","style","useState","editor","setEditor","hasLoadedEmbedScript","setHasLoadedEmbedScript","editorId","useMemo","options","appearance","displayMode","locale","projectId","tools","id","source","name","pkg","version","useImperativeHandle","useEffect","destroy","unlayer","createEditor","JSON","stringify","methodProps","keys","filter","propName","test","methodProp","addEventListener","join","flex","display"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA,IAAMA,gBAAgB,GAAG,uCAAuC;AAChE,IAAMC,SAAS,GAAe,EAAE;AAChC,IAAIC,MAAM,GAAG,KAAK;AAElB,IAAMC,gBAAgB,GAAG,SAAnBA,gBAAgB,CAAIC,SAAiB;EACzC,IAAMC,OAAO,GAAGC,QAAQ,CAACC,gBAAgB,CAAC,QAAQ,CAAC;EACnD,IAAIC,QAAQ,GAAG,KAAK;EAEpBH,OAAO,CAACI,OAAO,CAAC,UAACC,MAAM;IACrB,IAAIA,MAAM,CAACC,GAAG,CAACC,QAAQ,CAACR,SAAS,CAAC,EAAE;MAClCI,QAAQ,GAAG,IAAI;;GAElB,CAAC;EAEF,OAAOA,QAAQ;AACjB,CAAC;AAED,IAAMK,sBAAsB,GAAG,SAAzBA,sBAAsB;EAC1B,IAAMC,gBAAgB,GAAGC,MAAM,CAACC,QAAQ;EAExCC,MAAM,CAACC,cAAc,CAACH,MAAM,EAAE,UAAU,EAAE;IACxCI,YAAY,EAAE,IAAI;IAClBC,UAAU,EAAE,IAAI;IAChBC,GAAG,EAAE;;MAEH,OAAO;QACLC,IAAI,EAAE,iCAAiC;QACvCC,QAAQ,EAAE,QAAQ;QAClBC,IAAI,EAAE,yBAAyB;QAC/BC,QAAQ,EAAE,yBAAyB;QACnCC,QAAQ,EAAE,GAAG;QACbC,MAAM,EAAE,EAAE;QACVC,IAAI,EAAE;OACP;KACF;IACDC,GAAG,EAAE,aAASC,QAAQ;MACpBhB,gBAAgB,CAACQ,IAAI,GAAGQ,QAAQ,CAAC;;GAEpC,CAAC;;EAEF,OAAO;;IAELb,MAAM,CAACC,cAAc,CAACH,MAAM,EAAE,UAAU,EAAE;MACxCI,YAAY,EAAE,IAAI;MAClBC,UAAU,EAAE,IAAI;MAChBW,KAAK,EAAEjB;KACR,CAAC;GACH;AACH,CAAC;AAED,IAAMkB,WAAW,GAAG,SAAdA,WAAW,CAAIC,QAAkB;EACrChC,SAAS,CAACiC,IAAI,CAACD,QAAQ,CAAC;AAC1B,CAAC;AAED,IAAME,YAAY,GAAG,SAAfA,YAAY;EAChB,IAAIjC,MAAM,EAAE;IACV,IAAI+B,QAAQ;IAEZ,OAAQA,QAAQ,GAAGhC,SAAS,CAACmC,KAAK,EAAE,EAAG;MACrCH,QAAQ,EAAE;;;AAGhB,CAAC;AAED,AAAO,IAAMI,UAAU,GAAG,SAAbA,UAAU,CACrBJ,QAAkB,EAClB7B,SAAS;MAATA,SAAS;IAATA,SAAS,GAAGJ,gBAAgB;;EAE5BgC,WAAW,CAACC,QAAQ,CAAC;EAErB,IAAI,CAAC9B,gBAAgB,CAACC,SAAS,CAAC,EAAE;IAChC,IAAMkC,OAAO,GAAGzB,sBAAsB,EAAE;IACxC,IAAM0B,WAAW,GAAGjC,QAAQ,CAACkC,aAAa,CAAC,QAAQ,CAAC;IACpDD,WAAW,CAACE,YAAY,CAAC,KAAK,EAAErC,SAAS,CAAC;IAC1CmC,WAAW,CAACG,MAAM,GAAG;MACnBxC,MAAM,GAAG,IAAI;MACboC,OAAO,EAAE;MACTH,YAAY,EAAE;KACf;IACD7B,QAAQ,CAACqC,IAAI,CAACC,WAAW,CAACL,WAAW,CAAC;GACvC,MAAM;IACLJ,YAAY,EAAE;;AAElB,CAAC;;ACxED,IAAMU,GAAG,GACP,OAAO9B,MAAM,KAAK,WAAW,GAAG;EAAE+B,sBAAsB,EAAE;CAAG,GAAG/B,MAAM;AACxE8B,GAAG,CAACC,sBAAsB,GAAGD,GAAG,CAACC,sBAAsB,IAAI,CAAC;AAE5D,IAAaC,WAAW,gBAAGC,cAAK,CAACC,UAAU,CACzC,UAACC,KAAK,EAAEC,GAAG;;EACT,IAAQC,MAAM,GAAsDF,KAAK,CAAjEE,MAAM;IAAEC,OAAO,GAA6CH,KAAK,CAAzDG,OAAO;IAAEjD,SAAS,GAAkC8C,KAAK,CAAhD9C,SAAS;IAAA,mBAAkC8C,KAAK,CAArCI,SAAS;IAATA,SAAS,iCAAG,GAAG;IAAA,eAAiBJ,KAAK,CAApBK,KAAK;IAALA,KAAK,6BAAG,EAAE;EAE/D,gBAA4BC,cAAQ,CAAgB,IAAI,CAAC;IAAlDC,MAAM;IAAEC,SAAS;EAExB,iBAAwDF,cAAQ,CAAC,KAAK,CAAC;IAAhEG,oBAAoB;IAAEC,uBAAuB;EAEpD,IAAMC,QAAQ,GAAGC,aAAO,CACtB;IAAA,OAAMZ,KAAK,CAACW,QAAQ,gBAAc,EAAEhB,GAAG,CAACC,sBAAwB;KAChE,CAACI,KAAK,CAACW,QAAQ,CAAC,CACjB;EAED,IAAME,OAAO,gBACPb,KAAK,CAACa,OAAO,IAAI,EAAE;IACvBC,UAAU,uBAAEd,KAAK,CAACc,UAAU,kDAAId,KAAK,CAACa,OAAO,qBAAb,eAAeC,UAAU;IACzDC,WAAW,EAAE,CAAAf,KAAK,oBAALA,KAAK,CAAEe,WAAW,yBAAIf,KAAK,CAACa,OAAO,qBAAb,gBAAeE,WAAW,KAAI,OAAO;IACxEC,MAAM,mBAAEhB,KAAK,CAACgB,MAAM,+CAAIhB,KAAK,CAACa,OAAO,qBAAb,gBAAeG,MAAM;IAC7CC,SAAS,sBAAEjB,KAAK,CAACiB,SAAS,kDAAIjB,KAAK,CAACa,OAAO,qBAAb,gBAAeI,SAAS;IACtDC,KAAK,kBAAElB,KAAK,CAACkB,KAAK,8CAAIlB,KAAK,CAACa,OAAO,qBAAb,gBAAeK,KAAK;IAE1CC,EAAE,EAAER,QAAQ;IACZS,MAAM,EAAE;MACNC,IAAI,EAAEC,GAAG,CAACD,IAAI;MACdE,OAAO,EAAED,GAAG,CAACC;;IAEhB;EAEDC,yBAAmB,CACjBvB,GAAG,EACH;IAAA,OAAO;MACLM,MAAM,EAANA;KACD;GAAC,EACF,CAACA,MAAM,CAAC,CACT;EAEDkB,eAAS,CAAC;IACR,OAAO;MACLlB,MAAM,oBAANA,MAAM,CAAEmB,OAAO,EAAE;KAClB;GACF,EAAE,EAAE,CAAC;EAEND,eAAS,CAAC;IACRf,uBAAuB,CAAC,KAAK,CAAC;IAC9BvB,UAAU,CAAC;MAAA,OAAMuB,uBAAuB,CAAC,IAAI,CAAC;OAAExD,SAAS,CAAC;GAC3D,EAAE,CAACA,SAAS,CAAC,CAAC;EAEfuE,eAAS,CAAC;IACR,IAAI,CAAChB,oBAAoB,EAAE;IAC3BF,MAAM,oBAANA,MAAM,CAAEmB,OAAO,EAAE;IACjBlB,SAAS,CAACmB,OAAO,CAACC,YAAY,CAACf,OAAO,CAAC,CAAC;GACzC,EAAE,CAACgB,IAAI,CAACC,SAAS,CAACjB,OAAO,CAAC,EAAEJ,oBAAoB,CAAC,CAAC;EAEnD,IAAMsB,WAAW,GAAGhE,MAAM,CAACiE,IAAI,CAAChC,KAAK,CAAC,CAACiC,MAAM,CAAC,UAACC,QAAQ;IAAA,OACrD,KAAK,CAACC,IAAI,CAACD,QAAQ,CAAC;IACrB;EACDT,eAAS,CAAC;IACR,IAAI,CAAClB,MAAM,EAAE;IAEbL,MAAM,oBAANA,MAAM,CAAGK,MAAM,CAAC;;IAGhBwB,WAAW,CAACxE,OAAO,CAAC,UAAC6E,UAAU;MAC7B,IACE,KAAK,CAACD,IAAI,CAACC,UAAU,CAAC,IACtBA,UAAU,KAAK,QAAQ,IACvBA,UAAU,KAAK,SAAS,IACxB,OAAOpC,KAAK,CAACoC,UAAU,CAAC,KAAK,UAAU,EACvC;QACA7B,MAAM,CAAC8B,gBAAgB,CAACD,UAAU,EAAEpC,KAAK,CAACoC,UAAU,CAAC,CAAC;;KAEzD,CAAC;IAEF,IAAIjC,OAAO,EAAE;MACXI,MAAM,CAAC8B,gBAAgB,CAAC,cAAc,EAAE;QACtClC,OAAO,CAACI,MAAM,CAAC;OAChB,CAAC;;GAEL,EAAE,CAACA,MAAM,EAAExC,MAAM,CAACiE,IAAI,CAACD,WAAW,CAAC,CAACO,IAAI,CAAC,GAAG,CAAC,CAAC,CAAC;EAEhD,OACExC;IACEO,KAAK,EAAE;MACLkC,IAAI,EAAE,CAAC;MACPC,OAAO,EAAE,MAAM;MACfpC,SAAS,EAAEA;;KAGbN;IAAKqB,EAAE,EAAER,QAAQ;IAAEN,KAAK,eAAOA,KAAK;MAAEkC,IAAI,EAAE;;IAAO,CAC/C;AAEV,CAAC,CACF;;;;;"}